import{a as Te,k as o,a8 as le,a5 as Ie,A as we,c as _,p as P,v as ne,u as r,i as s,w as n,a9 as He,r as h,aa as Ke,o as d,b as m,x as B,h as F,y,e as M,z as Je,t as V,ab as Ge,ac as A,F as Ze,g as Qe,ad as R,n as ie,_ as We}from"./index-02828706.js";import{r as Xe,E as Ye,a as ea,b as aa,c as N,d as ta,e as se,f as la,g as na,h as ia,i as sa,j as oa,k as da,l as ua,m as ra}from"./codeEditor-644d51e2.js";const ca={class:"search_bar"},va={style:{width:"100%","margin-right":"10px"}},ma={class:"search_file"},pa={class:"handle_tabbar",style:{"margin-top":"10px"}},fa=["onContextmenu"],ha=["onClick"],_a=["onContextmenu"],ya={key:0},ga=["onClick"],ka=["onContextmenu"],xa={key:0,class:"file_upload_box"},ba={key:1},Ca={key:2,style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},Fa=["src"],Ma={key:3,style:{width:"100","max-height":"100%"}},Ra=["src"],Da=["src"],Ua=Te({__name:"index",setup(Va){const E=o(!1),T=o(""),I=o(""),w=o(""),O=o(""),oe=o(!1),x=o(!1),g=o(""),H=o(),de=o(),ue=o();let K=le({path:""}),z=le({name:"",mtime:"",type:"",size:"",path:"",isBlur:!1,isRightClicked:!1}),re=o([{name:"删除"},{name:"上传"},{name:"移动"},{name:"下载"},{name:"复制"},{name:"命名"}]),i=o("0"),p=o([]),D=o("name"),b=o(!1),U=o(""),q=o(""),C=o(!1),c=o([]),j=o({}),J=o(""),ce=o(""),S=o([]);const k=async(e="0")=>{E.value=!0;let a=await Xe(e);a.code==200&&(p.value=a.data.children,i.value=a.data.path,E.value=!1)},ve=async e=>{let a=await ea(e.path,e.type);a.code==200&&(e.size=a.data)},me=Ie(()=>{let e=[];if(D.value=="name"){let a=[],l=[];p.value.forEach(v=>{v.type=="file"?l.push(v):a.push(v)}),e=[...a,...l]}else D.value=="time"?e=p.value.slice().sort((a,l)=>{const v=new Date(a.mtime).getTime(),f=new Date(l.mtime).getTime();return v-f}):e=p.value;return b.value?e.reverse():e}),G=e=>{e=="name"?D.value=="name"?b.value=!b.value:(D.value="name",b.value=!1):e=="time"&&(D.value=="time"?b.value=!b.value:(D.value="time",b.value=!1))},pe=()=>{let e=i.value.lastIndexOf("/");e==-1&&(e=i.value.lastIndexOf("\\")),i.value=i.value.slice(0,e),k(i.value)},fe=()=>{k(i.value)},he=async()=>{let e=await aa(i.value,U.value);U.value="",e.code==200&&(p.value=e.data)},_e=e=>{const a=e.lastIndexOf(".");return a===-1?"js":e.substring(a+1)},ye=async e=>{if(e.type=="file"){if(Object.assign(z,e),/\.(png|jpg|jpeg|gif|bmp|tiff|webp|svg)$/.test(e.name)){let l=await N(e.path);I.value=URL.createObjectURL(l),g.value="viewImage",x.value=!0;return}if(/\.(mp3|wav|aac|m4a|ogg|flac|wma|ape|alac|amr|awb|aiff|caf|mka|opus|ra|rm|spx|tta|voc|wavpack|xm|mod|s3m|it|xmf|mid|midi|kar|rmi)$/.test(e.name)){let l=await N(e.path);w.value=URL.createObjectURL(l),g.value="viewAudio",x.value=!0;return}if(/\.(mp4|avi|mov|wmv|mpeg|flv|mkv|vob|3gp|webm|m4v)$/.test(e.name)){let l=await N(e.path);O.value=URL.createObjectURL(l),g.value="viewVideo",x.value=!0;return}let a=await ta(e.path);a.code==200&&(C.value=!0,q.value=a.data,T.value=_e(e.name));return}k(e.path)},ge=async e=>{(await se(z.path,e.toString())).code==200&&(R.success("保存成功！"),C.value=!1,q.value="")},ke=e=>{e=="文件"?p.value.unshift({name:"",mtime:"",type:"file",size:"",path:i.value,isBlur:!0}):e=="目录"&&p.value.unshift({name:"",mtime:"",type:"directory",size:"",path:i.value,isBlur:!0});let a=p.value.find(l=>l.isBlur==!0);ie(()=>{j.value[a.name.replace(/\./g,"")+a.type].focus()})},xe=(e,a)=>{const l=new Set;for(let v=0;v<e.length;v++){const f=e[v][a];if(l.has(f))return!0;l.add(f)}return!1},Z=async(e,a="blur",l="create")=>{if(e.isBlur=!1,a=="enter")return;if(e.name||(e.name="新建标题"),xe(p.value,"name")){R.error("该标题已存在！！"),k(i.value);return}let f;e.handlerMode=="命名"&&(l="rename"),l=="create"?e.type=="file"?f=await se(i.value+"/"+e.name,""):f=await la(i.value+"/"+e.name):l=="rename"&&(f=await na(i.value+"/"+J.value,i.value+"/"+e.name),e.handlerMode==""),f.code==200&&k(i.value)},be=async e=>{let a;e.type=="file"?a=await ua(e.path):a=await ra(e.path),a.code==200&&(console.log(a),k(i.value))},Q=async e=>{c.value.push(e)},Ce=async()=>{for(let e=0;e<c.value.length;e++){let a=c.value[e],l;a.handlerMode=="移动"?l=await ia(a.path,i.value+"/"+a.name):a.handlerMode=="复制"?a.type=="file"?l=await sa(a.path,i.value+"/"+a.name):l=await oa(a.path,i.value+"/"+a.name):R.error("请选择右侧操作"),l.code==200&&R.success("粘贴成功！")}c.value=[],k(i.value)},Fe=e=>{J.value=e.name,e.isBlur=!0,ie(()=>{j.value[e.name.replace(/\./g,"")+e.type].focus()})},L=e=>{for(let a=0;a<p.value.length;a++)p.value[a].isRightClicked=!1;e.isRightClicked=!0},Me=()=>{for(let e=0;e<p.value.length;e++)p.value[e].isRightClicked=!1},W=()=>{K.path=i.value,g.value="upload",x.value=!0},X=(e,a)=>{switch(e.isRightClicked=!1,a.name){case"删除":be(e);break;case"移动":e.handlerMode="移动",Q(e);break;case"复制":e.handlerMode="复制",Q(e);break;case"命名":e.handlerMode="命名",Fe(e);break;case"上传":e.handlerMode="上传",W();break;case"下载":e.handlerMode="下载",Se(e);break;default:R.error("右键相关操作出错了")}},Re=e=>{c.value.some(l=>!!l.handlerMode)||(c.value=JSON.parse(JSON.stringify(e)))},Y=e=>{for(let a=0;a<c.value.length;a++)c.value[a].handlerMode=e},De=e=>{ce.value=e.url,x.value=!0},Ue=e=>{console.log(e),k(i.value)},Ve=()=>{H.value.submit(),x.value=!1},Se=async e=>{if(console.log(e),e.type=="file"){let a=await da(e.path);R.success("开始下载...");const l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=e.name,document.body.appendChild(l),l.click(),document.body.removeChild(l)}else R.warning("请下载文件或压缩包")},$e=()=>{oe.value=!1},Be=e=>{};return we(()=>{k("0")}),(e,a)=>{const l=h("el-button"),v=h("el-input"),f=h("el-popover"),ee=h("el-option"),Ee=h("el-select"),$=h("el-table-column"),Oe=h("el-popconfirm"),ze=h("el-table"),ae=h("el-card"),qe=h("el-upload"),je=h("el-image"),Le=h("el-dialog"),Pe=Ke("loading");return d(),_("div",null,[P(s(ae,{class:"box-card"},{default:n(()=>[m("div",ca,[m("div",va,[s(v,{modelValue:r(i),"onUpdate:modelValue":a[0]||(a[0]=t=>B(i)?i.value=t:i=t),style:{"max-width":"600px",width:"100%","min-width":"200px"},class:"input-with-select"},{prepend:n(()=>[s(l,{icon:"Back",onClick:pe})]),append:n(()=>[s(l,{icon:"DArrowRight",onClick:fe})]),_:1},8,["modelValue"])]),m("div",ma,[s(f,{placement:"bottom",title:"搜索",width:300,trigger:"hover"},{reference:n(()=>[s(l,{icon:"Search",circle:""})]),default:n(()=>[s(v,{modelValue:r(U),"onUpdate:modelValue":a[1]||(a[1]=t=>B(U)?U.value=t:U=t),placeholder:"输入搜索文件或目录"},{append:n(()=>[s(l,{icon:"Search",onClick:he})]),_:1},8,["modelValue"])]),_:1})])]),m("div",pa,[s(Ee,{placeholder:"新建",style:{width:"80px"},onChange:ke},{default:n(()=>[s(ee,{label:"目录",value:"目录"}),s(ee,{label:"文件",value:"文件"})]),_:1}),r(c).length>0&&r(c).every(t=>t.handlerMode)?(d(),F(l,{key:0,type:"primary",onClick:a[2]||(a[2]=t=>Ce()),style:{"margin-left":"10px"}},{default:n(()=>[y(" 粘贴 ")]),_:1})):M("",!0),s(l,{onClick:W,style:{"margin-left":"10px"}},{default:n(()=>[y(" 上传 ")]),_:1}),r(c).length>0?(d(),F(l,{key:1,disabled:r(c).every(t=>t.handlerMode=="复制"),type:"primary",onClick:a[3]||(a[3]=t=>Y("复制")),style:{"margin-left":"10px"}},{default:n(()=>[y(" 复制 ")]),_:1},8,["disabled"])):M("",!0),r(c).length>0?(d(),F(l,{key:2,disabled:r(c).every(t=>t.handlerMode=="移动"),type:"primary",onClick:a[4]||(a[4]=t=>Y("移动")),style:{"margin-left":"10px"}},{default:n(()=>[y(" 移动 ")]),_:1},8,["disabled"])):M("",!0)]),P((d(),F(ze,{style:{margin:"10px 0"},data:me.value,"max-height":"450",onSelectionChange:Re,onClick:Me},{default:n(()=>[s($,{type:"selection",align:"center"}),s($,{label:"文件名称"},{header:n(()=>[m("div",{class:"title-active",onClick:a[5]||(a[5]=t=>G("name"))}," 文件名称 ")]),default:n(({row:t,$index:te})=>[s(f,{placement:"bottom",title:t.type=="file"?"文件操作":"文件夹操作",width:150,trigger:"contextmenu",visible:t.isRightClicked},{reference:n(()=>[m("div",{onContextmenu:A(u=>L(t),["prevent"])},[m("i",{class:Je(`iconfont icon-file 
                                            icon-${t.type=="file"?t.name.split(".").at(-1):"yellowFolder"}
                                        `),style:{"font-size":"20px"}},null,2),y("   "),t.isBlur?(d(),F(v,{key:1,ref:u=>{r(j)[t.name.replace(/\./g,"")+t.type]=u},onBlur:u=>Z(t,"blur"),onKeyup:Ge(u=>Z(t,"enter"),["enter"]),modelValue:t.name,"onUpdate:modelValue":u=>t.name=u},null,8,["onBlur","onKeyup","modelValue","onUpdate:modelValue"])):(d(),_("a",{key:0,onClick:u=>ye(t)},V(t.name),9,ha))],40,fa)]),default:n(()=>[(d(!0),_(Ze,null,Qe(r(re),(u,Ae)=>(d(),_("span",{class:"pop_menu",key:Ae},[u.name=="删除"?(d(),F(Oe,{key:0,title:`您即将删除路径【${t.path}】,是否继续？`,onConfirm:Ne=>X(t,u)},{reference:n(()=>[s(l,null,{default:n(()=>[y(V(u.name),1)]),_:2},1024)]),_:2},1032,["title","onConfirm"])):(d(),F(l,{key:1,onClick:Ne=>X(t,u)},{default:n(()=>[y(V(u.name),1)]),_:2},1032,["onClick"]))]))),128))]),_:2},1032,["title","visible"])]),_:1}),s($,{label:"大小",width:"80px"},{default:n(({row:t,$index:te})=>[m("div",{onContextmenu:A(u=>L(t),["prevent"]),style:{"font-size":"12px"}},[t.size?(d(),_("span",ya,V(t.size),1)):(d(),_("a",{key:1,onClick:u=>ve(t)},"计算",8,ga))],40,_a)]),_:1}),s($,{label:"修改时间"},{header:n(()=>[m("div",{class:"title-active",onClick:a[6]||(a[6]=t=>G("time"))}," 修改时间 ")]),default:n(({row:t,$index:te})=>[m("div",{onContextmenu:A(u=>L(t),["prevent"]),style:{"font-size":"12px"}},V(t.mtime.replace(/T/," ").replace(/\.\d{3}Z/,"")),41,ka)]),_:1})]),_:1},8,["data"])),[[Pe,E.value]])]),_:1},512),[[ne,!r(C)]]),P(s(ae,null,{default:n(()=>[s(l,{style:{"margin-bottom":"5px"},onClick:a[7]||(a[7]=t=>B(C)?C.value=!1:C=!1)},{default:n(()=>[y(" 返回 ")]),_:1}),s(Ye,{code:r(q),ext:T.value,onGetCode:ge},null,8,["code","ext"])]),_:1},512),[[ne,r(C)]]),s(Le,{modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=t=>x.value=t),title:r(z).name},He({default:n(()=>[g.value=="upload"?(d(),_("div",xa,[s(qe,{class:"file_uploader",action:"/api/fs/upload",multiple:"",ref_key:"uploadRef",ref:H,"file-list":r(S),"onUpdate:fileList":a[8]||(a[8]=t=>B(S)?S.value=t:S=t),data:r(K),"show-file-list":!0,"on-preview":De,"on-success":Ue,"before-upload":Be,"auto-upload":!1},{trigger:n(()=>[s(l,{type:"primary"},{default:n(()=>[y("选择文件")]),_:1})]),_:1},8,["file-list","data"])])):M("",!0),g.value=="viewImage"?(d(),_("div",ba,[s(je,{src:I.value,lazy:""},null,8,["src"])])):M("",!0),g.value=="viewAudio"?(d(),_("div",Ca,[m("audio",{ref_key:"audioElement",ref:de,controls:"",src:w.value,style:{width:"100%"},onEnded:$e},null,40,Fa)])):M("",!0),g.value=="viewVideo"?(d(),_("div",Ma,[m("video",{controls:"",ref_key:"videoElement",ref:ue,style:{width:"100%",height:"100%","object-fit":"cover"}},[m("source",{src:O.value,type:"video/mp4"},null,8,Ra),m("source",{src:O.value,type:"video/ogg"},null,8,Da)],512)])):M("",!0)]),_:2},[g.value=="upload"?{name:"footer",fn:n(()=>[s(l,{type:"primary",size:"default",onClick:Ve},{default:n(()=>[y(" 确认提交 ")]),_:1})]),key:"0"}:void 0]),1032,["modelValue","title"])])}}});const Ba=We(Ua,[["__scopeId","data-v-731c986b"]]);export{Ba as default};
