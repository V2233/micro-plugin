import{a7 as h,a as Ie,k as r,a8 as ie,a5 as He,A as Ke,c as k,p as T,v as se,u as p,i as o,w as n,a9 as Je,r as y,aa as Ge,o as d,b as m,x as O,h as D,y as b,e as U,z as We,t as z,ab as Ze,ac as A,F as Qe,g as Xe,ad as V,n as oe,_ as Ye}from"./index-6b89b52f.js";import{E as et}from"./codeEditor-1620cd68.js";const tt=i=>h.get("/fs/listdir/?path="+i),at=(i,u)=>h.get("/fs/filesize?path="+i+"&type="+u),lt=i=>h.get("/fs/mkdir/?path="+i),nt=i=>h.get("/fs/open/?path="+i),N=i=>h.get("/fs/media?path="+i,{responseType:"blob"}),it=i=>h.delete("/fs/rmfile/?path="+i),st=i=>h.delete("/fs/rmdir/?path="+i),re=(i,u)=>h.post("/fs/savefile/?path="+i,{content:u}),ot=(i,u)=>h.get("/fs/movefile/?path="+i+"&newPath="+u),rt=(i,u)=>h.get("/fs/copyfile/?path="+i+"&newPath="+u),ut=(i,u)=>h.get("/fs/copydir/?path="+i+"&newPath="+u),dt=(i,u)=>h.get("/fs/renamefile/?path="+i+"&newPath="+u),ct=(i,u)=>h.get("/fs/search/?path="+i+"&keyWord="+u),pt=i=>h.get("/fs/download?path="+i,{responseType:"blob"}),vt={class:"search_bar"},ft={style:{width:"100%","margin-right":"10px"}},mt={class:"search_file"},ht={class:"handle_tabbar",style:{"margin-top":"10px"}},_t=["onContextmenu"],gt=["onClick"],yt=["onContextmenu"],kt={key:0},bt=["onClick"],xt=["onContextmenu"],Ct={key:0,class:"file_upload_box"},Ft={key:1},Mt={key:2,style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},Rt=["src"],Dt={key:3,style:{width:"100","max-height":"100%"}},Ut=["src"],Vt=["src"],St=Ie({__name:"index",setup(i){const u=r(!1),I=r(""),H=r(""),K=r(""),q=r(""),ue=r(!1),F=r(!1),x=r(""),J=r(),de=r(),ce=r();let G=ie({path:""}),j=ie({name:"",mtime:"",type:"",size:"",path:"",isBlur:!1,isRightClicked:!1}),pe=r([{name:"删除"},{name:"上传"},{name:"移动"},{name:"下载"},{name:"复制"},{name:"命名"}]),s=r("0"),_=r([]),S=r("name"),M=r(!1),$=r(""),L=r(""),R=r(!1),v=r([]),P=r({}),W=r(""),ve=r(""),B=r([]);const C=async(e="0")=>{u.value=!0;let t=await tt(e);t.code==200&&(_.value=t.data.children,s.value=t.data.path,u.value=!1)},fe=async e=>{let t=await at(e.path,e.type);t.code==200&&(e.size=t.data)},me=He(()=>{let e=[];if(S.value=="name"){let t=[],l=[];_.value.forEach(f=>{f.type=="file"?l.push(f):t.push(f)}),e=[...t,...l]}else S.value=="time"?e=_.value.slice().sort((t,l)=>{const f=new Date(t.mtime).getTime(),g=new Date(l.mtime).getTime();return f-g}):e=_.value;return M.value?e.reverse():e}),Z=e=>{e=="name"?S.value=="name"?M.value=!M.value:(S.value="name",M.value=!1):e=="time"&&(S.value=="time"?M.value=!M.value:(S.value="time",M.value=!1))},he=()=>{let e=s.value.lastIndexOf("/");e==-1&&(e=s.value.lastIndexOf("\\")),s.value=s.value.slice(0,e),C(s.value)},_e=()=>{C(s.value)},ge=async()=>{let e=await ct(s.value,$.value);$.value="",e.code==200&&(_.value=e.data)},ye=e=>{const t=e.lastIndexOf(".");return t===-1?"js":e.substring(t+1)},ke=async e=>{if(e.type=="file"){if(Object.assign(j,e),/\.(png|jpg|jpeg|gif|bmp|tiff|webp|svg)$/.test(e.name)){let l=await N(e.path);H.value=URL.createObjectURL(l),x.value="viewImage",F.value=!0;return}if(/\.(mp3|wav|aac|m4a|ogg|flac|wma|ape|alac|amr|awb|aiff|caf|mka|opus|ra|rm|spx|tta|voc|wavpack|xm|mod|s3m|it|xmf|mid|midi|kar|rmi)$/.test(e.name)){let l=await N(e.path);K.value=URL.createObjectURL(l),x.value="viewAudio",F.value=!0;return}if(/\.(mp4|avi|mov|wmv|mpeg|flv|mkv|vob|3gp|webm|m4v)$/.test(e.name)){let l=await N(e.path);q.value=URL.createObjectURL(l),x.value="viewVideo",F.value=!0;return}let t=await nt(e.path);t.code==200&&(R.value=!0,L.value=t.data,I.value=ye(e.name));return}C(e.path)},be=async e=>{(await re(j.path,e.toString())).code==200&&(V.success("保存成功！"),R.value=!1,L.value="")},xe=e=>{e=="文件"?_.value.unshift({name:"",mtime:"",type:"file",size:"",path:s.value,isBlur:!0}):e=="目录"&&_.value.unshift({name:"",mtime:"",type:"directory",size:"",path:s.value,isBlur:!0});let t=_.value.find(l=>l.isBlur==!0);oe(()=>{P.value[t.name.replace(/\./g,"")+t.type].focus()})},Ce=(e,t)=>{const l=new Set;for(let f=0;f<e.length;f++){const g=e[f][t];if(l.has(g))return!0;l.add(g)}return!1},Q=async(e,t="blur",l="create")=>{if(e.isBlur=!1,t=="enter")return;if(e.name||(e.name="新建标题"),Ce(_.value,"name")){V.error("该标题已存在！！"),C(s.value);return}let g;e.handlerMode=="命名"&&(l="rename"),l=="create"?e.type=="file"?g=await re(s.value+"/"+e.name,""):g=await lt(s.value+"/"+e.name):l=="rename"&&(g=await dt(s.value+"/"+W.value,s.value+"/"+e.name),e.handlerMode==""),g.code==200&&C(s.value)},Fe=async e=>{let t;e.type=="file"?t=await it(e.path):t=await st(e.path),t.code==200&&(console.log(t),C(s.value))},X=async e=>{v.value.push(e)},Me=async()=>{for(let e=0;e<v.value.length;e++){let t=v.value[e],l;t.handlerMode=="移动"?l=await ot(t.path,s.value+"/"+t.name):t.handlerMode=="复制"?t.type=="file"?l=await rt(t.path,s.value+"/"+t.name):l=await ut(t.path,s.value+"/"+t.name):V.error("请选择右侧操作"),l.code==200&&V.success("粘贴成功！")}v.value=[],C(s.value)},Re=e=>{W.value=e.name,e.isBlur=!0,oe(()=>{P.value[e.name.replace(/\./g,"")+e.type].focus()})},w=e=>{for(let t=0;t<_.value.length;t++)_.value[t].isRightClicked=!1;e.isRightClicked=!0},De=()=>{for(let e=0;e<_.value.length;e++)_.value[e].isRightClicked=!1},Y=()=>{G.path=s.value,x.value="upload",F.value=!0},ee=(e,t)=>{switch(e.isRightClicked=!1,t.name){case"删除":Fe(e);break;case"移动":e.handlerMode="移动",X(e);break;case"复制":e.handlerMode="复制",X(e);break;case"命名":e.handlerMode="命名",Re(e);break;case"上传":e.handlerMode="上传",Y();break;case"下载":e.handlerMode="下载",ze(e);break;default:V.error("右键相关操作出错了")}},Ue=e=>{v.value.some(l=>!!l.handlerMode)||(v.value=JSON.parse(JSON.stringify(e)))},te=e=>{for(let t=0;t<v.value.length;t++)v.value[t].handlerMode=e},Ve=e=>{ve.value=e.url,F.value=!0},Se=e=>{console.log(e),C(s.value)},$e=()=>{J.value.submit(),F.value=!1},ze=async e=>{if(console.log(e),e.type=="file"){let t=await pt(e.path);V.success("开始下载...");const l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=e.name,document.body.appendChild(l),l.click(),document.body.removeChild(l)}else V.warning("请下载文件或压缩包")},Be=()=>{ue.value=!1},Ee=e=>{};return Ke(()=>{C("0")}),(e,t)=>{const l=y("el-button"),f=y("el-input"),g=y("el-popover"),ae=y("el-option"),Oe=y("el-select"),E=y("el-table-column"),qe=y("el-popconfirm"),je=y("el-table"),le=y("el-card"),Le=y("el-upload"),Pe=y("el-image"),we=y("el-dialog"),Te=Ge("loading");return d(),k("div",null,[T(o(le,{class:"box-card"},{default:n(()=>[m("div",vt,[m("div",ft,[o(f,{modelValue:p(s),"onUpdate:modelValue":t[0]||(t[0]=a=>O(s)?s.value=a:s=a),style:{"max-width":"600px",width:"100%","min-width":"200px"},class:"input-with-select"},{prepend:n(()=>[o(l,{icon:"Back",onClick:he})]),append:n(()=>[o(l,{icon:"DArrowRight",onClick:_e})]),_:1},8,["modelValue"])]),m("div",mt,[o(g,{placement:"bottom",title:"搜索",width:300,trigger:"hover"},{reference:n(()=>[o(l,{icon:"Search",circle:""})]),default:n(()=>[o(f,{modelValue:p($),"onUpdate:modelValue":t[1]||(t[1]=a=>O($)?$.value=a:$=a),placeholder:"输入搜索文件或目录"},{append:n(()=>[o(l,{icon:"Search",onClick:ge})]),_:1},8,["modelValue"])]),_:1})])]),m("div",ht,[o(Oe,{placeholder:"新建",style:{width:"80px"},onChange:xe},{default:n(()=>[o(ae,{label:"目录",value:"目录"}),o(ae,{label:"文件",value:"文件"})]),_:1}),p(v).length>0&&p(v).every(a=>a.handlerMode)?(d(),D(l,{key:0,type:"primary",onClick:t[2]||(t[2]=a=>Me()),style:{"margin-left":"10px"}},{default:n(()=>[b(" 粘贴 ")]),_:1})):U("",!0),o(l,{onClick:Y,style:{"margin-left":"10px"}},{default:n(()=>[b(" 上传 ")]),_:1}),p(v).length>0?(d(),D(l,{key:1,disabled:p(v).every(a=>a.handlerMode=="复制"),type:"primary",onClick:t[3]||(t[3]=a=>te("复制")),style:{"margin-left":"10px"}},{default:n(()=>[b(" 复制 ")]),_:1},8,["disabled"])):U("",!0),p(v).length>0?(d(),D(l,{key:2,disabled:p(v).every(a=>a.handlerMode=="移动"),type:"primary",onClick:t[4]||(t[4]=a=>te("移动")),style:{"margin-left":"10px"}},{default:n(()=>[b(" 移动 ")]),_:1},8,["disabled"])):U("",!0)]),T((d(),D(je,{style:{margin:"10px 0"},data:me.value,"max-height":"450",onSelectionChange:Ue,onClick:De},{default:n(()=>[o(E,{type:"selection",align:"center"}),o(E,{label:"文件名称"},{header:n(()=>[m("div",{class:"title-active",onClick:t[5]||(t[5]=a=>Z("name"))}," 文件名称 ")]),default:n(({row:a,$index:ne})=>[o(g,{placement:"bottom",title:a.type=="file"?"文件操作":"文件夹操作",width:150,trigger:"contextmenu",visible:a.isRightClicked},{reference:n(()=>[m("div",{onContextmenu:A(c=>w(a),["prevent"])},[m("i",{class:We(`iconfont icon-file 
                                            icon-${a.type=="file"?a.name.split(".").at(-1):"yellowFolder"}
                                        `),style:{"font-size":"20px"}},null,2),b("   "),a.isBlur?(d(),D(f,{key:1,ref:c=>{p(P)[a.name.replace(/\./g,"")+a.type]=c},onBlur:c=>Q(a,"blur"),onKeyup:Ze(c=>Q(a,"enter"),["enter"]),modelValue:a.name,"onUpdate:modelValue":c=>a.name=c},null,8,["onBlur","onKeyup","modelValue","onUpdate:modelValue"])):(d(),k("a",{key:0,onClick:c=>ke(a)},z(a.name),9,gt))],40,_t)]),default:n(()=>[(d(!0),k(Qe,null,Xe(p(pe),(c,Ae)=>(d(),k("span",{class:"pop_menu",key:Ae},[c.name=="删除"?(d(),D(qe,{key:0,title:`您即将删除路径【${a.path}】,是否继续？`,onConfirm:Ne=>ee(a,c)},{reference:n(()=>[o(l,null,{default:n(()=>[b(z(c.name),1)]),_:2},1024)]),_:2},1032,["title","onConfirm"])):(d(),D(l,{key:1,onClick:Ne=>ee(a,c)},{default:n(()=>[b(z(c.name),1)]),_:2},1032,["onClick"]))]))),128))]),_:2},1032,["title","visible"])]),_:1}),o(E,{label:"大小",width:"80px"},{default:n(({row:a,$index:ne})=>[m("div",{onContextmenu:A(c=>w(a),["prevent"]),style:{"font-size":"12px"}},[a.size?(d(),k("span",kt,z(a.size),1)):(d(),k("a",{key:1,onClick:c=>fe(a)},"计算",8,bt))],40,yt)]),_:1}),o(E,{label:"修改时间"},{header:n(()=>[m("div",{class:"title-active",onClick:t[6]||(t[6]=a=>Z("time"))}," 修改时间 ")]),default:n(({row:a,$index:ne})=>[m("div",{onContextmenu:A(c=>w(a),["prevent"]),style:{"font-size":"12px"}},z(a.mtime.replace(/T/," ").replace(/\.\d{3}Z/,"")),41,xt)]),_:1})]),_:1},8,["data"])),[[Te,u.value]])]),_:1},512),[[se,!p(R)]]),T(o(le,null,{default:n(()=>[o(l,{style:{"margin-bottom":"5px"},onClick:t[7]||(t[7]=a=>O(R)?R.value=!1:R=!1)},{default:n(()=>[b(" 返回 ")]),_:1}),o(et,{code:p(L),ext:I.value,onGetCode:be},null,8,["code","ext"])]),_:1},512),[[se,p(R)]]),o(we,{modelValue:F.value,"onUpdate:modelValue":t[9]||(t[9]=a=>F.value=a),title:p(j).name},Je({default:n(()=>[x.value=="upload"?(d(),k("div",Ct,[o(Le,{class:"file_uploader",action:"/api/fs/upload",multiple:"",ref_key:"uploadRef",ref:J,"file-list":p(B),"onUpdate:fileList":t[8]||(t[8]=a=>O(B)?B.value=a:B=a),data:p(G),"show-file-list":!0,"on-preview":Ve,"on-success":Se,"before-upload":Ee,"auto-upload":!1},{trigger:n(()=>[o(l,{type:"primary"},{default:n(()=>[b("选择文件")]),_:1})]),_:1},8,["file-list","data"])])):U("",!0),x.value=="viewImage"?(d(),k("div",Ft,[o(Pe,{src:H.value,lazy:""},null,8,["src"])])):U("",!0),x.value=="viewAudio"?(d(),k("div",Mt,[m("audio",{ref_key:"audioElement",ref:de,controls:"",src:K.value,style:{width:"100%"},onEnded:Be},null,40,Rt)])):U("",!0),x.value=="viewVideo"?(d(),k("div",Dt,[m("video",{controls:"",ref_key:"videoElement",ref:ce,style:{width:"100%",height:"100%","object-fit":"cover"}},[m("source",{src:q.value,type:"video/mp4"},null,8,Ut),m("source",{src:q.value,type:"video/ogg"},null,8,Vt)],512)])):U("",!0)]),_:2},[x.value=="upload"?{name:"footer",fn:n(()=>[o(l,{type:"primary",size:"default",onClick:$e},{default:n(()=>[b(" 确认提交 ")]),_:1})]),key:"0"}:void 0]),1032,["modelValue","title"])])}}});const Bt=Ye(St,[["__scopeId","data-v-731c986b"]]);export{Bt as default};
